# Contributor: Jose G Perez Taveras <josegpt27@gmail.com>
# Maintainer: Jose G Perez Taveras <josegpt27@gmail.com>
pkgname=josegpt.com
pkgver=1.0.2
pkgrel=2
pkgdesc="My personal website"
url="https://git.sr.ht/~josegpt/josegpt.com"
arch="all"
license="MIT"
makedepends="go"
subpackages="$pkgname-openrc $pkgname-nginx:nginx:noarch"
source="$pkgname-v$pkgver.tar.gz::https://git.sr.ht/~josegpt/josegpt.com/archive/v$pkgver.tar.gz
	$pkgname-nginx.conf
	$pkgname.initd
	$pkgname.confd"
builddir="$srcdir/$pkgname-v$pkgver"
install="$pkgname.pre-install $pkgname.pre-deinstall"

build() {
	go build -v -o "$pkgname" cmd/josegpt/main.go
}

check() {
	go test -v ./...
}

package() {
	install -Dm755 "$pkgname" "$pkgdir"/usr/bin/"$pkgname"
	install -Dm750 "$srcdir"/"$pkgname".initd \
			"$pkgdir"/etc/init.d/"$pkgname"
	install -Dm750 "$srcdir"/"$pkgname".confd \
			"$pkgdir"/etc/conf.d/"$pkgname"
	install -dm750 -onginx -gwww-data "$pkgdir"/var/www/josegpt.com/static
	cp -R static "$pkgdir"/var/www/josegpt.com
}

nginx() {
	depends="ptserver-nginx ptserver-uacme"
	pkgdesc="nginx configuration for $pkgname"
	install -Dm644 "$srcdir/josegpt.com-nginx.conf" \
			"$subpkgdir"/etc/nginx/http.d/josegpt.com.conf
}

sha512sums="
ebdb6880c72067eaef2e57065af29f4026fc88a64e115287d18f1b10b365fe9d5a80603151ea372c6577cabeeede697aa8516aa689b7310e1fdda387ac5a2904  josegpt.com-v1.0.2.tar.gz
eca0b4a0ad159a2049fe1bfd032ea171c5908dd38640d3b38dcb3e54667dab7181f902fb8f21f83271b82064ca281985e02ef043268ba1c62da9c1c01aeed248  josegpt.com-nginx.conf
10d4edd007c81a8192e487bdcefb5a88ab2602f5ca0338434276b6e86d4ef812931f1a482b21c98bffed765a59731161092b5e0f5210be1b156e5495a698ef5b  josegpt.com.initd
5464c6f0ef073df41cf420e7419be15aa1b8aec8fd23664c2a0b03f4b8bbd531d65c7e305107e3ae7149713e7c595bb512afeab7cd25785871daf6c7e6e6d53f  josegpt.com.confd
"
