# Contributor: Jose G Perez Taveras <josegpt27@gmail.com>
# Maintainer: Jose G Perez Taveras <josegpt27@gmail.com>
pkgname=josegpt.com
pkgver=1.0.3
pkgrel=0
pkgdesc="My personal website"
url="https://git.sr.ht/~josegpt/josegpt.com"
arch="all"
license="MIT"
makedepends="go"
subpackages="$pkgname-openrc $pkgname-nginx:nginx:noarch"
source="$pkgname-v$pkgver.tar.gz::https://git.sr.ht/~josegpt/josegpt.com/archive/v$pkgver.tar.gz
	$pkgname-nginx.conf
	$pkgname.initd
	$pkgname.confd"
builddir="$srcdir/$pkgname-v$pkgver"
install="$pkgname.pre-install $pkgname.pre-deinstall"

build() {
	go build -v -o "$pkgname" cmd/josegpt/main.go
}

check() {
	go test -v ./...
}

package() {
	install -Dm755 "$pkgname" "$pkgdir"/usr/bin/"$pkgname"
	install -Dm750 "$srcdir"/"$pkgname".initd \
			"$pkgdir"/etc/init.d/"$pkgname"
	install -Dm750 "$srcdir"/"$pkgname".confd \
			"$pkgdir"/etc/conf.d/"$pkgname"
	install -dm750 -onginx -gwww-data "$pkgdir"/var/www/josegpt.com/static
	cp -R static "$pkgdir"/var/www/josegpt.com
}

nginx() {
	depends="ptserver-nginx ptserver-uacme"
	pkgdesc="nginx configuration for $pkgname"
	install -Dm644 "$srcdir/josegpt.com-nginx.conf" \
			"$subpkgdir"/etc/nginx/http.d/josegpt.com.conf
}

sha512sums="
1f3423a2e6dd59b52bae24707ac77f8dac69ba5b7633b0c66a74fbbc9933483ae4a1a11e0ca36d234d2f5e8a321c189923c2bb647da066412ce787b5e368ee20  josegpt.com-v1.0.3.tar.gz
111cbe0f9f81d12a932d0bf6df975ffbdaf61a9919dbce62941138f5273bff451660ed22c1debb1fd5eecb007951e9438db9b4721aa33147fbd61bd241f0b3b4  josegpt.com-nginx.conf
5447331e7e8ab508b3dcb009f1458441baf9273f469be7dfe675d61a178e1b2a966d055ac09d60e3f61fa086e319ac4d0500e16a8352564ef2266104810df39c  josegpt.com.initd
dc7a58657683e936ca3f413a5b30b8c9196b8e6fd93ff215a2a3b04579ef4d668fcf61affc4aae2092f0ebd0836cdb9fd0939389345f87bd033f18d599cd679f  josegpt.com.confd
"
